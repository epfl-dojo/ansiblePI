---
- name: Install ACL
  apt:
    name: acl
    state: present
  become: yes

- name: Add several users from ./vars/main.yml
  user:
    name: "{{ item.name }}"
    state: present
  become: yes
  with_items: "{{ piusers }}"

- name: Ensure ssh keys in user's home
  authorized_key:
    user: "{{ item.name }}"
    state: present
    key: "https://github.com/{{ item.ghname }}.keys"
    comment: "{{ item.name }} aka {{ item.ghname }}@github"
  with_items: "{{ piusers }}"
  become: yes
  become_user: "{{ item.name }}"

- name: Ensure uers's ssh keys in dojo account
  authorized_key:
    user: dojo
    state: present
    key: https://github.com/{{ item.ghname }}.keys
    comment: "{{ item.name }} aka {{ item.ghname }}@github"
  with_items: "{{ piusers }}"
  become: yes
  become_user: dojo

- name: Ensure uers's ssh keys in root account
  authorized_key:
    user: root
    state: present
    key: https://github.com/{{ item.ghname }}.keys
    comment: "{{ item.name }} aka {{ item.ghname }}@github"
  with_items: "{{ piusers }}"
  become: yes
